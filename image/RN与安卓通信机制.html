<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>RN与安卓通信机制</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="zocj" id="rn与安卓通信机制">RN与安卓通信机制</h1><hr><p data-anchor-id="0s2b">ReactNative与安卓通信的四种方式  --&gt;通过继承ReactContextBaseJavaModule类来实现的数据</p><blockquote data-anchor-id="e50l" class="white-blockquote">
  <ul>
  <li>方式一 RCTDeviceEventEmitter 监听</li>
  <li>方式二 CallBack回调方式</li>
  <li>方式三 Promises 方式</li>
  <li>方式四 Map 共享Android数据</li>
  </ul>
</blockquote><table data-anchor-id="ritn" class="table table-striped-white table-bordered">
<thead>
<tr>
 <th>方式</th>
 <th style="text-align:right;">优点</th>
 <th style="text-align:center;">缺点</th>
</tr>
</thead>
<tbody><tr>
 <td>RCTDeviceEventEmitter</td>
 <td style="text-align:right;">可任意时刻传递，Native主导控制</td>
 <td style="text-align:center;">缺点较小，但要写监听</td>
</tr>
<tr>
 <td>CallBack回调方式</td>
 <td style="text-align:right;">JS调用一次，Native返回一次</td>
 <td style="text-align:center;">CallBack为异步操作，返回时机不确定</td>
</tr>
<tr>
 <td>Promises 方式</td>
 <td style="text-align:right;">JS调用一次，Native返回一次</td>
 <td style="text-align:center;">每次使用需要JS调用一次</td>
</tr>
<tr>
 <td>Map 共享Android数据</td>
 <td style="text-align:right;">一直存在</td>
 <td style="text-align:center;">一直存在</td>
</tr>
</tbody></table><blockquote data-anchor-id="t0tt" class="white-blockquote">
  <p>一  准备工作：使用react-native init DemoName 新建一个RN工程； <br>
  a) 首先在原生工程中(app\src\mian\java\xxx包名.\，与MainActivity同目录下) <br>
  b)   新建MyNativeModule类且继承ReactContextBaseJavaModule, <br>
  c)   --&gt;导包--&gt;解决爆红错误（实际是继承父类的中必须初始化一个有参构造方法，且将本类名返回return“类名”）</p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="edxb"><ol class="linenums"><li class="L0"><code class="language-android"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyNativeModule</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">ReactContextBaseJavaModule</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-android"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">MyNativeModule</span><span class="pun">(</span><span class="typ">ReactApplicationContext</span><span class="pln"> reactContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-android"><span class="pln">        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">reactContext</span><span class="pun">);</span></code></li><li class="L3"><code class="language-android"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code class="language-android"><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L5"><code class="language-android"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-android"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"MyNativeModule"</span><span class="pun">;</span></code></li><li class="L7"><code class="language-android"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-android"><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="br7e" class="white-blockquote">
  <p>二 a)在同级目录下创建MyReactPackage类，且实现了implements  ReactPackage, b)然后再createNativeModules中创建list集合将MyNativeModule添加进去 <br>
  c)在createViewManagers中调用Collections.emptyList()返回；</p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="mbsf"><ol class="linenums"><li class="L0"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyNativePackage</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ReactPackage</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">NativeModule</span><span class="pun">&gt;</span><span class="pln"> createNativeModules</span><span class="pun">(</span><span class="typ">ReactApplicationContext</span><span class="pln"> reactApplicationContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">NativeModule</span><span class="pun">&gt;</span><span class="pln"> nativeModules </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;&gt;();</span></code></li><li class="L4"><code><span class="pln">        nativeModules</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyNativeModule</span><span class="pun">(</span><span class="pln">reactApplicationContext</span><span class="pun">));</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> nativeModules</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ViewManager</span><span class="pun">&gt;</span><span class="pln"> createViewManagers</span><span class="pun">(</span><span class="typ">ReactApplicationContext</span><span class="pln"> reactApplicationContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">emptyList</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="8q5h" class="white-blockquote">
  <p>三  打开工程的MainApplication 类 在getPackages 中new MyNativePackage(),添加进去</p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ubz9"><ol class="linenums"><li class="L0"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MainApplication</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Application</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ReactApplication</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">  </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ReactNativeHost</span><span class="pln"> mReactNativeHost </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ReactNativeHost</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> getUseDeveloperSupport</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">      </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">BuildConfig</span><span class="pun">.</span><span class="pln">DEBUG</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ReactPackage</span><span class="pun">&gt;</span><span class="pln"> getPackages</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">      </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Arrays</span><span class="pun">.&lt;</span><span class="typ">ReactPackage</span><span class="pun">&gt;</span><span class="pln">asList</span><span class="pun">(</span></code></li><li class="L0"><code><span class="pln">          </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MainReactPackage</span><span class="pun">(),</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyNativePackage</span><span class="pun">()</span></code></li><li class="L1"><code><span class="pln">      </span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getJSMainModuleName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">      </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"index"</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">  </span><span class="pun">};</span></code></li><li class="L8"><code><span class="pln">  </span><span class="lit">@Override</span></code></li><li class="L9"><code><span class="pln">  </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ReactNativeHost</span><span class="pln"> getReactNativeHost</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> mReactNativeHost</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L2"><code><span class="pln">  </span><span class="lit">@Override</span></code></li><li class="L3"><code><span class="pln">  </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onCreate</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onCreate</span><span class="pun">();</span></code></li><li class="L5"><code><span class="pln">    </span><span class="typ">SoLoader</span><span class="pun">.</span><span class="pln">init</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="com">/* native exopackage */</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="46nk" class="white-blockquote">
  <p><strong>四 编写基本交互代码</strong> <br>
  <strong>1）RN向原生发送消息，携带msg信息 ；使用场景一 MyNativeModule  RN 调用原生，不需要回调   RN调用原生去做某件事，不管这件事的成功与否 异常等，不再过问；</strong></p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="esgb"><ol class="linenums"><li class="L0"><code><span class="com">//RN端：（事件调用者） Android端的</span></code></li><li class="L1"><code><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">sendNativeMsg</span><span class="pun">(</span><span class="pln">JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="str">"你好"</span><span class="pun">));</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">//android端：（事件执行者）</span></code></li><li class="L4"><code><span class="com">//在MyNativeModule中编写一个方法（无返回值)</span></code></li><li class="L5"><code><span class="com">//sendNativeMsg，且注解为@ReactMethod 方法</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="lit">@ReactMethod</span></code></li><li class="L8"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendNativeMsg</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">){</span></code></li><li class="L9"><code><span class="pln">            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AlertDialog</span></code></li><li class="L0"><code><span class="pln">            </span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">.</span><span class="pln">getCurrentActivity</span><span class="pun">())</span></code></li><li class="L1"><code><span class="pln">            </span><span class="pun">.</span><span class="pln">setMessage</span><span class="pun">(</span><span class="str">""</span><span class="pun">+</span><span class="pln">msg</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pln">            </span><span class="pun">.</span><span class="pln">show</span><span class="pun">();</span></code></li><li class="L3"><code><span class="pln">       </span><span class="com">//原生  dosomething ；</span></code></li><li class="L4"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="d2fq" class="white-blockquote">
  <p><strong>2)</strong> <strong>第二种 使用CallBack 来完成交互 <br>
  使用场景二：RN调用native 且携带callbak接口回调RN端</strong></p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ot4p"><ol class="linenums"><li class="L0"><code><span class="com">//RN端：（事件调用者）</span></code></li><li class="L1"><code><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">sendNativeMsgCallBack</span><span class="pun">(</span><span class="str">"回调"</span><span class="pun">,(</span><span class="pln">json</span><span class="pun">)=&gt;{</span></code></li><li class="L2"><code><span class="pln">    alert</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">list</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pun">});</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="com">//android端：（事件执行者）</span></code></li><li class="L6"><code><span class="com">//RN发送信息，执行原生代码，执行完后回调</span></code></li><li class="L7"><code><span class="com">//说明：RN和android 数据传输的载体有两种方式，</span></code></li><li class="L8"><code><span class="com">//一种是string，</span></code></li><li class="L9"><code><span class="com">//一种是map（WritableMap，ReadtableMap）</span></code></li><li class="L0"><code><span class="com">// 源码介绍：Interface for a map that allows typed access to its members.  Used to pass parameters from JS to Java.</span></code></li><li class="L1"><code><span class="com">//使用： 从RN向Android 传输数据的时候 原生在接受对象时使用的是ReadtableMap</span></code></li><li class="L2"><code><span class="com">//       从Android向Rn 传输数据的时候，参数的包装的对象是 WritableMap</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="lit">@ReactMethod</span></code></li><li class="L5"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendNativeMsgCallBack</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Callback</span><span class="pln"> callback</span><span class="pun">){</span></code></li><li class="L6"><code><span class="pln">    </span><span class="typ">String</span><span class="pln"> msgContent </span><span class="pun">=</span><span class="pln"> msg</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">    </span><span class="typ">WritableMap</span><span class="pln"> writableMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WritableNativeMap</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">    </span><span class="typ">WritableArray</span><span class="pln"> writableArray </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WritableNativeArray</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">    writableArray</span><span class="pun">.</span><span class="pln">pushString</span><span class="pun">(</span><span class="str">"北京"</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    writableArray</span><span class="pun">.</span><span class="pln">pushString</span><span class="pun">(</span><span class="str">"上海"</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    writableArray</span><span class="pun">.</span><span class="pln">pushString</span><span class="pun">(</span><span class="str">"杭州"</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    writableMap</span><span class="pun">.</span><span class="pln">putArray</span><span class="pun">(</span><span class="str">"list"</span><span class="pun">,</span><span class="pln">writableArray</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">    callback</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="pln">writableMap</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="oy9s" class="white-blockquote">
  <p><strong>3 第三种使用Promise 回调结果  场景三 安卓端执行原生代码，promise返回</strong></p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="qhtm"><ol class="linenums"><li class="L0"><code><span class="com">//RN端：（事件调用者）</span></code></li><li class="L1"><code><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">sendPromiseTime</span><span class="pun">(</span><span class="str">"promise"</span><span class="pun">).</span><span class="kwd">then</span><span class="pun">((</span><span class="pln">json</span><span class="pun">)=&gt;{</span></code></li><li class="L2"><code><span class="pln">   alert</span><span class="pun">(</span><span class="pln">JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="pln">json</span><span class="pun">));</span></code></li><li class="L3"><code><span class="pun">});</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="com">//Android端：</span></code></li><li class="L6"><code><span class="lit">@ReactMethod</span></code></li><li class="L7"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendPromiseTime</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Promise</span><span class="pln"> promise</span><span class="pun">){</span></code></li><li class="L8"><code><span class="pln">    </span><span class="typ">WritableMap</span><span class="pln"> writableMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WritableNativeMap</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">    writableMap</span><span class="pun">.</span><span class="pln">putString</span><span class="pun">(</span><span class="str">"chuangde"</span><span class="pun">,</span><span class="str">"promise"</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    promise</span><span class="pun">.</span><span class="pln">resolve</span><span class="pun">(</span><span class="pln">writableMap</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="aaud" class="white-blockquote">
  <p><strong>4  第四种 使用共享数据来交互 场景四安卓端直接在初始化的时候将数据存放在内存中 ，RN直接获取</strong></p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="moqf"><ol class="linenums"><li class="L0"><code><span class="com">//RN端：</span></code></li><li class="L1"><code><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">//Android端：获取手机的设备信息等 例如 设备ID</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pun">&lt;!--源码介绍介绍：</span><span class="pln"> </span><span class="lit">@return</span><span class="pln"> a map of constants </span><span class="kwd">this</span><span class="pln"> </span><span class="kwd">module</span><span class="pln"> exports to JS</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Supports</span><span class="pln"> JSON types</span><span class="pun">.--&gt;</span></code></li><li class="L6"><code><span class="lit">@Override</span></code></li><li class="L7"><code><span class="kwd">public</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> getConstants</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">    </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> objectMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span></code></li><li class="L9"><code><span class="pln">    </span><span class="typ">TelephonyManager</span><span class="pln"> telephonyManager </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">TelephonyManager</span><span class="pun">)</span><span class="pln">mContext</span><span class="pun">.</span><span class="pln">getSystemService</span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">TELEPHONY_SERVICE</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">    objectMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"lxd"</span><span class="pun">,</span><span class="str">"soyouarehere"</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">    objectMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"deviceId"</span><span class="pun">,</span><span class="pln">telephonyManager</span><span class="pun">.</span><span class="pln">getDeviceId</span><span class="pun">());</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> objectMap</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="y14p" class="white-blockquote">
  <p><strong>场景五：RN向native 发送事件消息，native执行完后返回 <br>
  eventName: 自定义的监听事件的名字。必须为string <br>
  DeviceEventEmitter：RN提供的监听原生方法， <br>
  addListener：调用此方法将我们自定义的监听事件加入整个事件监听循环中</strong>；</p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="2b2n"><ol class="linenums"><li class="L0"><code><span class="com">//RN端：</span></code></li><li class="L1"><code><span class="kwd">let</span><span class="pln"> eventName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"nativeCallRnMethodListener"</span><span class="pun">;</span><span class="com">//监听事件的名字eventName</span></code></li><li class="L2"><code><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">nativeSendRnMsg</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">);</span><span class="com">//调用方法</span></code></li><li class="L3"><code><span class="typ">DeviceEventEmitter</span><span class="pun">.</span><span class="pln">addListener</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,(</span><span class="pln">msg</span><span class="pun">)=&gt;{</span><span class="com">//监听native发送的消息执行回调</span></code></li><li class="L4"><code><span class="pln">    </span><span class="typ">DeviceEventEmitter</span><span class="pun">.</span><span class="pln">removeAllListeners</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pun">});</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">//Android端：</span></code></li><li class="L8"><code><span class="lit">@ReactMethod</span></code></li><li class="L9"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> nativeSendRnMsg</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> eventName</span><span class="pun">){</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Runnable</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">        </span><span class="lit">@Override</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">            </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">                </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">3000</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">                sendRNMsgString</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln">eventName</span><span class="pun">,</span><span class="str">"我很好！！！"</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">InterruptedException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">                e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L9"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}).</span><span class="pln">start</span><span class="pun">();</span></code></li><li class="L1"><code><span class="pun">}</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">//getJSModule：&lt;!--@return handle to the specified JS module for the CatalystInstance associated with this Context--&gt;</span></code></li><li class="L4"><code><span class="com">//DeviceEventManagerModule----RN内部实现的module</span></code></li><li class="L5"><code><span class="com">//RCTDeviceEventEmitter  --JavaScriptModule 的接口</span></code></li><li class="L6"><code><span class="com">//emit---------------------实现了该方法 </span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendRNMsgString</span><span class="pun">(</span><span class="typ">ReactContext</span><span class="pln"> reactContext</span><span class="pun">,</span><span class="typ">String</span><span class="pln"> eventName</span><span class="pun">,</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">){</span><span class="pln">reactContext</span><span class="pun">.</span><span class="pln">getJSModule</span><span class="pun">(</span><span class="typ">DeviceEventManagerModule</span><span class="pun">.</span><span class="typ">RCTDeviceEventEmitter</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">).</span><span class="pln">emit</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,</span><span class="pln"> msg</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="h4kq" class="white-blockquote">
  <p><strong>场景六：RN端调用Native执行代码弹窗选择，监听事件处理，并将结果返回给RN</strong></p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="lnug"><ol class="linenums"><li class="L0"><code><span class="pln">RN</span><span class="pun">端：</span></code></li><li class="L1"><code><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">nativeShowImagePicker</span><span class="pun">((</span><span class="pln">msg</span><span class="pun">)=&gt;{</span></code></li><li class="L2"><code><span class="com">//js代码</span></code></li><li class="L3"><code><span class="pun">});</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="typ">Android</span><span class="pun">端：</span></code></li><li class="L6"><code><span class="lit">@ReactMethod</span></code></li><li class="L7"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> nativeShowImagePicker</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Callback</span><span class="pln"> callback</span><span class="pun">){</span></code></li><li class="L8"><code><span class="pln">    </span><span class="typ">Activity</span><span class="pln"> activity </span><span class="pun">=</span><span class="pln"> getCurrentActivity</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">   </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">activity</span><span class="pun">==</span><span class="kwd">null</span><span class="pun">){</span></code></li><li class="L0"><code><span class="pln">       responseHelp</span><span class="pun">.</span><span class="pln">invokeError</span><span class="pun">(</span><span class="pln">callback</span><span class="pun">,</span><span class="str">"找不到MainActivity"</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">   </span><span class="pun">}</span></code></li><li class="L2"><code><span class="pln">    </span><span class="typ">AlertDialog</span><span class="pln"> alertDialog </span><span class="pun">=</span><span class="pln"> </span><span class="typ">UiAlert</span><span class="pun">.</span><span class="pln">shooseAlert</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UiAlert</span><span class="pun">.</span><span class="typ">UIAlertListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="lit">@Override</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onReturnResult</span><span class="pun">(</span><span class="typ">MyNativeModule</span><span class="pln"> myNativeModule</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="typ">Toast</span><span class="pun">.</span><span class="pln">makeText</span><span class="pun">(</span><span class="pln">myNativeModule</span><span class="pun">.</span><span class="pln">getActivity</span><span class="pun">(),</span><span class="str">"ssssssss"</span><span class="pun">,</span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">LENGTH_SHORT</span><span class="pun">).</span><span class="pln">show</span><span class="pun">();</span></code></li><li class="L6"><code><span class="pln">callback</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="str">"你选择了某条"</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">});</span></code></li><li class="L9"><code><span class="pln">    alertDialog</span><span class="pun">.</span><span class="pln">show</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pun">}</span></code></li></ol></pre><blockquote data-anchor-id="f904" class="white-blockquote">
  <p>js中的代码</p>
</blockquote><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="cebj"><ol class="linenums"><li class="L0"><code><span class="kwd">import</span><span class="pln"> </span><span class="typ">React</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'react'</span><span class="pun">;</span></code></li><li class="L1"><code><span class="kwd">import</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">  </span><span class="typ">Platform</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">  </span><span class="typ">StyleSheet</span><span class="pun">,</span></code></li><li class="L4"><code><span class="pln">  </span><span class="typ">ScrollView</span><span class="pun">,</span></code></li><li class="L5"><code><span class="pln">  </span><span class="typ">Text</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">  </span><span class="typ">TouchableOpacity</span><span class="pun">,</span></code></li><li class="L7"><code><span class="pln">  </span><span class="typ">NativeModules</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pln">  </span><span class="typ">DeviceEventEmitter</span><span class="pun">,</span></code></li><li class="L9"><code><span class="pln">  </span><span class="typ">Image</span><span class="pun">,</span></code></li><li class="L0"><code><span class="pln">  </span><span class="typ">View</span></code></li><li class="L1"><code><span class="pun">}</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'react-native'</span><span class="pun">;</span></code></li><li class="L2"><code><span class="com">// import  ImagePicker from 'react-native-image-picker'; //第三方相机</span></code></li><li class="L3"><code><span class="kwd">const</span><span class="pln"> instructions </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Platform</span><span class="pun">.</span><span class="kwd">select</span><span class="pun">({</span></code></li><li class="L4"><code><span class="pln">  ios</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Press Cmd+R to reload,\n'</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L5"><code><span class="pln">    </span><span class="str">'Cmd+D or shake for dev menu'</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">  android</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Double tap R on your keyboard to reload,\n'</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L7"><code><span class="pln">    </span><span class="str">'Shake or press menu button for dev menu'</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pun">});</span></code></li><li class="L9"><code><span class="kwd">let</span><span class="pln"> _jsonData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">0</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'0第一种：RN发送信息到原生，执行原生代码==进行弹窗-没有回调'</span><span class="pun">},</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'1第二种：CallBack.invoke，执行原生代码，执行完后回调'</span><span class="pun">},</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">2</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'2第三种：Promise,执行原生代码，返回数据'</span><span class="pun">},</span></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">3</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'3第四种：与java共享已初始化完毕的数据'</span><span class="pun">},</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">4</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'4Android主动向RN发送消息： 执行原生代码执行结束后发送消息'</span><span class="pun">},</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">5</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'5使用场景一：Listener方式RN调用原生拍照，裁剪，将图片返回给RN 展示在界面上'</span><span class="pun">},</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">6</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'6使用场景三：RN发送信息'</span><span class="pun">},</span></code></li><li class="L7"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">7</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'7使用场景四：RN调用原生，进行弹窗列表，将事件的结果传递到RN'</span><span class="pun">},</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">{</span><span class="pln">code</span><span class="pun">:</span><span class="lit">8</span><span class="pun">,</span><span class="pln">textContent</span><span class="pun">:</span><span class="str">'8使用场景五：CallBack方式不需要中间间，照相裁剪 直接获取数据返回'</span><span class="pun">},</span></code></li><li class="L9"><code><span class="pun">]</span><span class="pln"> </span><span class="pun">;</span></code></li><li class="L0"><code><span class="kwd">let</span><span class="pln"> imagePath </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">type </span><span class="typ">Props</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span></code></li><li class="L2"><code><span class="kwd">var</span><span class="pln"> photoOptions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//底部弹出框选项</span></code></li><li class="L4"><code><span class="pln">    title</span><span class="pun">:</span><span class="str">'请选择'</span><span class="pun">,</span></code></li><li class="L5"><code><span class="pln">    cancelButtonTitle</span><span class="pun">:</span><span class="str">'取消'</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">    takePhotoButtonTitle</span><span class="pun">:</span><span class="str">'拍照'</span><span class="pun">,</span></code></li><li class="L7"><code><span class="pln">    chooseFromLibraryButtonTitle</span><span class="pun">:</span><span class="str">'选择相册'</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pln">    quality</span><span class="pun">:</span><span class="lit">0.75</span><span class="pun">,</span></code></li><li class="L9"><code><span class="pln">    allowsEditing</span><span class="pun">:</span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L0"><code><span class="pln">    noData</span><span class="pun">:</span><span class="kwd">false</span><span class="pun">,</span></code></li><li class="L1"><code><span class="pln">    storageOptions</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        skipBackup</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">        path</span><span class="pun">:</span><span class="str">'images'</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code><span class="pun">}</span></code></li><li class="L6"><code><span class="kwd">export</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">App</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Component</span><span class="pun">&lt;</span><span class="typ">Props</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    constructor</span><span class="pun">(</span><span class="pln">props</span><span class="pun">){</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">props</span><span class="pun">)</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">state</span><span class="pun">={</span></code></li><li class="L1"><code><span class="pln">            imgPath</span><span class="pun">:</span><span class="str">''</span><span class="pun">,</span></code></li><li class="L2"><code><span class="pln">            avatarSource</span><span class="pun">:{</span><span class="pln">uri</span><span class="pun">:</span><span class="str">'https://upload.wikimedia.org/wikipedia/commons/d/de/Bananavarieties.jpg'</span><span class="pun">},</span></code></li><li class="L3"><code><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code><span class="pln">  render</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span></code></li><li class="L7"><code><span class="pln">      </span><span class="pun">&lt;</span><span class="typ">View</span><span class="pln"> style</span><span class="pun">={</span><span class="pln">styles</span><span class="pun">.</span><span class="pln">container</span><span class="pun">}&gt;</span></code></li><li class="L8"><code><span class="pln">        </span><span class="pun">&lt;</span><span class="typ">ScrollView</span><span class="pln"> </span><span class="pun">&gt;</span></code></li><li class="L9"><code><span class="pln">            </span><span class="pun">{</span><span class="pln">_jsonData</span><span class="pun">.</span><span class="pln">map</span><span class="pun">((</span><span class="pln">item</span><span class="pun">,</span><span class="pln">i</span><span class="pun">)=&gt;{</span></code></li><li class="L0"><code><span class="pln">                </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">&lt;</span><span class="typ">TouchableOpacity</span></code></li><li class="L1"><code><span class="pln">                    style</span><span class="pun">={</span><span class="pln">styles</span><span class="pun">.</span><span class="pln">item_external</span><span class="pun">}</span></code></li><li class="L2"><code><span class="pln">                    key</span><span class="pun">={</span><span class="pln">i</span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">                    onPress</span><span class="pun">={()=&gt;{</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">selectItemFromCode</span><span class="pun">(</span><span class="pln">item</span><span class="pun">.</span><span class="pln">code</span><span class="pun">)}}&gt;</span></code></li><li class="L4"><code><span class="pln">                  </span><span class="pun">&lt;</span><span class="typ">Text</span><span class="pun">&gt;{</span><span class="pln">item</span><span class="pun">.</span><span class="pln">textContent</span><span class="pun">}&lt;/</span><span class="typ">Text</span><span class="pun">&gt;</span></code></li><li class="L5"><code><span class="pln">                </span><span class="pun">&lt;/</span><span class="typ">TouchableOpacity</span><span class="pun">&gt;</span></code></li><li class="L6"><code><span class="pln">            </span><span class="pun">})}</span></code></li><li class="L7"><code><span class="pln">            </span><span class="pun">{</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">state</span><span class="pun">.</span><span class="pln">avatarSource</span><span class="pun">==</span><span class="str">''</span><span class="pun">?</span></code></li><li class="L8"><code><span class="pln">                </span><span class="pun">&lt;</span><span class="typ">Text</span><span class="pun">&gt;没有图片&lt;/</span><span class="typ">Text</span><span class="pun">&gt;:</span></code></li><li class="L9"><code><span class="pln">                </span><span class="pun">&lt;</span><span class="typ">Image</span></code></li><li class="L0"><code><span class="pln">                    source</span><span class="pun">={</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">state</span><span class="pun">.</span><span class="pln">avatarSource</span><span class="pun">}</span></code></li><li class="L1"><code><span class="pln">                    style</span><span class="pun">={{</span><span class="pln">height</span><span class="pun">:</span><span class="lit">100</span><span class="pun">,</span><span class="pln">width</span><span class="pun">:</span><span class="lit">100</span><span class="pun">}}&gt;</span></code></li><li class="L2"><code><span class="pln">                </span><span class="pun">&lt;/</span><span class="typ">Image</span><span class="pun">&gt;</span></code></li><li class="L3"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L4"><code><span class="pln">        </span><span class="pun">&lt;/</span><span class="typ">ScrollView</span><span class="pun">&gt;</span></code></li><li class="L5"><code><span class="pln">      </span><span class="pun">&lt;/</span><span class="typ">View</span><span class="pun">&gt;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">  selectItemFromCode</span><span class="pun">=(</span><span class="pln">code</span><span class="pun">)=&gt;{</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">code</span><span class="pun">){</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span></code></li><li class="L1"><code><span class="pln">            </span><span class="com">//第一种</span></code></li><li class="L2"><code><span class="pln">            </span><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">sendNativeMsg</span><span class="pun">(</span><span class="pln">JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="str">"你好"</span><span class="pun">));</span></code></li><li class="L3"><code><span class="pln">          </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span></code></li><li class="L5"><code><span class="pln">            </span><span class="com">//第二种</span></code></li><li class="L6"><code><span class="pln">            </span><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">sendNativeMsgCallBack</span><span class="pun">(</span><span class="str">"回调"</span><span class="pun">,(</span><span class="pln">json</span><span class="pun">)=&gt;{</span></code></li><li class="L7"><code><span class="pln">                alert</span><span class="pun">(</span><span class="pln">json</span><span class="pun">.</span><span class="pln">list</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L9"><code><span class="pln">          </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span></code></li><li class="L1"><code><span class="pln">            </span><span class="com">//第三种</span></code></li><li class="L2"><code><span class="pln">            </span><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">sendPromiseTime</span><span class="pun">(</span><span class="str">"promise"</span><span class="pun">).</span><span class="kwd">then</span><span class="pun">((</span><span class="pln">json</span><span class="pun">)=&gt;{</span></code></li><li class="L3"><code><span class="pln">               alert</span><span class="pun">(</span><span class="pln">JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="pln">json</span><span class="pun">));</span></code></li><li class="L4"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L5"><code><span class="pln">          </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span></code></li><li class="L7"><code><span class="pln">            </span><span class="com">//第四种</span></code></li><li class="L8"><code><span class="pln">            alert</span><span class="pun">(</span><span class="pln">JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">));</span></code></li><li class="L9"><code><span class="pln">            </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">4</span><span class="pun">:</span></code></li><li class="L1"><code><span class="pln">            </span><span class="com">//安卓发送消息到RN nativeSendRnMsg</span></code></li><li class="L2"><code><span class="pln">            </span><span class="kwd">let</span><span class="pln"> eventName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"nativeCallRnMethodListener"</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">            </span><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">nativeSendRnMsg</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">            </span><span class="typ">DeviceEventEmitter</span><span class="pun">.</span><span class="pln">addListener</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,(</span><span class="pln">msg</span><span class="pun">)=&gt;{</span></code></li><li class="L5"><code><span class="pln">                alert</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">                </span><span class="typ">DeviceEventEmitter</span><span class="pun">.</span><span class="pln">removeAllListeners</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L8"><code><span class="pln">            </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">5</span><span class="pun">:</span></code></li><li class="L0"><code><span class="pln">            </span><span class="com">//5使用场景一：RN调用原生拍照方法，进行裁剪，然后将图片返回给RN 展示在界面上</span></code></li><li class="L1"><code><span class="pln">            </span><span class="kwd">let</span><span class="pln"> eventNamePhotoListener  </span><span class="pun">=</span><span class="pln"> </span><span class="str">"eventNamePhotoListener"</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">            </span><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">senNativePhotograph</span><span class="pun">(</span><span class="pln">eventNamePhotoListener</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">            </span><span class="typ">DeviceEventEmitter</span><span class="pun">.</span><span class="pln">addListener</span><span class="pun">(</span><span class="pln">eventNamePhotoListener</span><span class="pun">,(</span><span class="pln">json</span><span class="pun">)=&gt;{</span></code></li><li class="L4"><code><span class="pln">                console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"获取路径17："</span><span class="pun">+</span><span class="pln">JSON</span><span class="pun">.</span><span class="pln">stringify</span><span class="pun">(</span><span class="pln">json</span><span class="pun">));</span></code></li><li class="L5"><code><span class="pln">                </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">setState</span><span class="pun">({</span></code></li><li class="L6"><code><span class="pln">                   avatarSource</span><span class="pun">:{</span><span class="pln">uri</span><span class="pun">:</span><span class="pln">json</span><span class="pun">.</span><span class="pln">imgPath</span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">                </span><span class="pun">});</span></code></li><li class="L8"><code><span class="pln">                </span><span class="typ">DeviceEventEmitter</span><span class="pun">.</span><span class="pln">removeAllListeners</span><span class="pun">(</span><span class="pln">eventNamePhotoListener</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">6</span><span class="pun">:</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">            </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">7</span><span class="pun">:</span></code></li><li class="L5"><code><span class="pln">            </span><span class="typ">NativeModules</span><span class="pun">.</span><span class="typ">MyNativeModule</span><span class="pun">.</span><span class="pln">nativeShowImagePicker</span><span class="pun">((</span><span class="pln">msg</span><span class="pun">)=&gt;{</span></code></li><li class="L6"><code><span class="pln">                alert</span><span class="pun">(</span><span class="pln">msg</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">            </span><span class="pun">});</span></code></li><li class="L8"><code><span class="pln">            </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">8</span><span class="pun">:</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">break</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L2"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pun">}</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="kwd">const</span><span class="pln"> styles </span><span class="pun">=</span><span class="pln"> </span><span class="typ">StyleSheet</span><span class="pun">.</span><span class="pln">create</span><span class="pun">({</span></code></li><li class="L6"><code><span class="pln">  container</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">    flex</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pln">  </span><span class="pun">},</span></code></li><li class="L9"><code><span class="pln">  item_external</span><span class="pun">:{</span></code></li><li class="L0"><code><span class="pln">      height</span><span class="pun">:</span><span class="lit">50</span><span class="pun">,</span></code></li><li class="L1"><code><span class="pln">      margin</span><span class="pun">:</span><span class="lit">10</span><span class="pun">,</span></code></li><li class="L2"><code><span class="pln">      borderRadius</span><span class="pun">:</span><span class="lit">10</span><span class="pun">,</span></code></li><li class="L3"><code><span class="pln">      backgroundColor</span><span class="pun">:</span><span class="str">'#32c17c'</span><span class="pun">,</span></code></li><li class="L4"><code><span class="pln">      alignItems</span><span class="pun">:</span><span class="str">'center'</span><span class="pun">,</span></code></li><li class="L5"><code><span class="pln">      justifyContent</span><span class="pun">:</span><span class="str">'center'</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">  </span><span class="pun">}</span><span class="pln"> </span><span class="pun">,</span></code></li><li class="L7"><code><span class="pln">  item</span><span class="pun">:{</span></code></li><li class="L8"><code><span class="pln">    alignItems</span><span class="pun">:</span><span class="str">'center'</span><span class="pun">,</span></code></li><li class="L9"><code><span class="pln">    justifyContent</span><span class="pun">:</span><span class="str">'center'</span><span class="pun">,</span></code></li><li class="L0"><code><span class="pln">  </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pun">});</span></code></li><li class="L2"><code></code></li><li class="L3"><code></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="com">//java代码</span></code></li><li class="L6"><code><span class="kwd">package</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">rnbridgeandroid</span><span class="pun">;</span></code></li><li class="L7"><code><span class="com">/**</span></code></li><li class="L8"><code><span class="com"> * Created by li.xiaodong on 2018/3/28.</span></code></li><li class="L9"><code><span class="com"> */</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyNativeModule</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">ReactContextBaseJavaModule</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ActivityEventListener</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">ReactApplicationContext</span><span class="pln"> mContext</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">MyNativeModule</span><span class="pun">(</span><span class="typ">ReactApplicationContext</span><span class="pln"> reactContext</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">reactContext</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">        mContext </span><span class="pun">=</span><span class="pln"> reactContext</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Activity</span><span class="pln"> getActivity</span><span class="pun">(){</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> getCurrentActivity</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"MyNativeModule"</span><span class="pun">;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">    </span><span class="com">/*</span></code></li><li class="L7"><code><span class="com">    * 第四种 共享数据</span></code></li><li class="L8"><code><span class="com">    * */</span></code></li><li class="L9"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> getConstants</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">        </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> objectMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span></code></li><li class="L2"><code><span class="pln">        </span><span class="typ">TelephonyManager</span><span class="pln"> telephonyManager </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">TelephonyManager</span><span class="pun">)</span><span class="pln"> mContext</span><span class="pun">.</span><span class="pln">getSystemService</span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">TELEPHONY_SERVICE</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        objectMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"lxd"</span><span class="pun">,</span><span class="str">"soyouarehere"</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        objectMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"deviceId"</span><span class="pun">,</span><span class="pln">telephonyManager</span><span class="pun">.</span><span class="pln">getDeviceId</span><span class="pun">());</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> objectMap</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">    </span><span class="com">//0RN发送信息到原生，执行原生代码==进行弹窗-没有回调</span></code></li><li class="L8"><code><span class="pln">    </span><span class="lit">@ReactMethod</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendNativeMsg</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">){</span></code></li><li class="L0"><code><span class="pln">        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AlertDialog</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">.</span><span class="pln">getCurrentActivity</span><span class="pun">()).</span><span class="pln">setMessage</span><span class="pun">(</span><span class="str">""</span><span class="pun">+</span><span class="pln">msg</span><span class="pun">).</span><span class="pln">show</span><span class="pun">();</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//1 RN发送信息，执行原生代码，执行完后回调</span></code></li><li class="L4"><code><span class="pln">    </span><span class="lit">@ReactMethod</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendNativeMsgCallBack</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Callback</span><span class="pln"> callback</span><span class="pun">){</span></code></li><li class="L6"><code><span class="pln">        </span><span class="typ">String</span><span class="pln"> msgContent </span><span class="pun">=</span><span class="pln"> msg</span><span class="pun">;</span></code></li><li class="L7"><code><span class="pln">        </span><span class="typ">WritableMap</span><span class="pln"> writableMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WritableNativeMap</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">        </span><span class="typ">WritableArray</span><span class="pln"> writableArray </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WritableNativeArray</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">        writableArray</span><span class="pun">.</span><span class="pln">pushString</span><span class="pun">(</span><span class="str">"北京"</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">        writableArray</span><span class="pun">.</span><span class="pln">pushString</span><span class="pun">(</span><span class="str">"上海"</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">        writableArray</span><span class="pun">.</span><span class="pln">pushString</span><span class="pun">(</span><span class="str">"杭州"</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">        writableMap</span><span class="pun">.</span><span class="pln">putArray</span><span class="pun">(</span><span class="str">"list"</span><span class="pun">,</span><span class="pln">writableArray</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        callback</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="pln">writableMap</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="com">/*</span></code></li><li class="L8"><code><span class="com">    * 第三种方式 Promise</span></code></li><li class="L9"><code><span class="com">    * */</span></code></li><li class="L0"><code><span class="pln">    </span><span class="lit">@ReactMethod</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendPromiseTime</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Promise</span><span class="pln"> promise</span><span class="pun">){</span></code></li><li class="L2"><code><span class="pln">        </span><span class="typ">WritableMap</span><span class="pln"> writableMap </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WritableNativeMap</span><span class="pun">();</span></code></li><li class="L3"><code><span class="pln">        writableMap</span><span class="pun">.</span><span class="pln">putString</span><span class="pun">(</span><span class="str">"lxd"</span><span class="pun">,</span><span class="str">"promise"</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        promise</span><span class="pun">.</span><span class="pln">resolve</span><span class="pun">(</span><span class="pln">writableMap</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="com">/*</span></code></li><li class="L8"><code><span class="com">    * Android 发送消息到原生</span></code></li><li class="L9"><code><span class="com">    * */</span></code></li><li class="L0"><code><span class="pln">    </span><span class="lit">@ReactMethod</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> nativeSendRnMsg</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> eventName</span><span class="pun">){</span></code></li><li class="L2"><code><span class="pln">        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Runnable</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L4"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">                </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">                    </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">3000</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">                    sendRNMsgString</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln">eventName</span><span class="pun">,</span><span class="str">"我很好！！！"</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">InterruptedException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">                    e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span></code></li><li class="L0"><code><span class="pln">                </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L2"><code><span class="pln">        </span><span class="pun">}).</span><span class="pln">start</span><span class="pun">();</span></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="com">/*</span></code></li><li class="L6"><code><span class="com">    * 使用场景一 RN调用原生拍照方法，进行裁剪，然后将图片返回给RN 展示在界面上</span></code></li><li class="L7"><code><span class="com">    * */</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="pln">    </span><span class="lit">@ReactMethod</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> senNativePhotograph</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> eventName</span><span class="pun">){</span></code></li><li class="L1"><code><span class="pln">        </span><span class="typ">Intent</span><span class="pln"> intent </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Intent</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">.</span><span class="pln">getCurrentActivity</span><span class="pun">(),</span><span class="typ">PhotographActivity</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">        intent</span><span class="pun">.</span><span class="pln">setFlags</span><span class="pun">(</span><span class="typ">Intent</span><span class="pun">.</span><span class="pln">FLAG_ACTIVITY_NEW_TASK</span><span class="pun">);</span></code></li><li class="L3"><code><span class="pln">        intent</span><span class="pun">.</span><span class="pln">putExtra</span><span class="pun">(</span><span class="str">"eventName"</span><span class="pun">,</span><span class="pln">eventName</span><span class="pun">);</span></code></li><li class="L4"><code><span class="pln">        mContext</span><span class="pun">.</span><span class="pln">startActivity</span><span class="pun">(</span><span class="pln">intent</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="com">/*</span></code></li><li class="L8"><code><span class="com">    * 将消息msg发送给RN侧</span></code></li><li class="L9"><code><span class="com">    * */</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendRNMsgString</span><span class="pun">(</span><span class="typ">ReactContext</span><span class="pln"> reactContext</span><span class="pun">,</span><span class="typ">String</span><span class="pln"> eventName</span><span class="pun">,</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">){</span></code></li><li class="L1"><code><span class="pln">        reactContext</span><span class="pun">.</span><span class="pln">getJSModule</span><span class="pun">(</span><span class="typ">DeviceEventManagerModule</span><span class="pun">.</span><span class="typ">RCTDeviceEventEmitter</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">).</span><span class="pln">emit</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,</span><span class="pln"> msg</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="com">/*</span></code></li><li class="L5"><code><span class="com">    * 向RN发送消息，携带集合数据</span></code></li><li class="L6"><code><span class="com">    * */</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendRnMsgMap</span><span class="pun">(</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> eventName</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@Nullable</span><span class="pln"> </span><span class="typ">WritableMap</span><span class="pln"> writableMap</span><span class="pun">){</span></code></li><li class="L8"><code><span class="pln">        mContext</span><span class="pun">.</span><span class="pln">getJSModule</span><span class="pun">(</span><span class="typ">DeviceEventManagerModule</span><span class="pun">.</span><span class="typ">RCTDeviceEventEmitter</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">).</span><span class="pln">emit</span><span class="pun">(</span><span class="pln">eventName</span><span class="pun">,</span><span class="pln"> writableMap</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/*</span></code></li><li class="L3"><code><span class="com">    * 照相 后获取照片</span></code></li><li class="L4"><code><span class="com">    * */</span></code></li><li class="L5"><code><span class="pln">    </span><span class="lit">@ReactMethod</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendNativeTakePhoto</span><span class="pun">(){</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onActivityResult</span><span class="pun">(</span><span class="typ">Activity</span><span class="pln"> activity</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> requestCode</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> resultCode</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Intent</span><span class="pln"> data</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onNewIntent</span><span class="pun">(</span><span class="typ">Intent</span><span class="pln"> intent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">ResponseHelp</span><span class="pln"> responseHelp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ResponseHelp</span><span class="pun">();</span></code></li><li class="L1"><code><span class="pln">    </span><span class="lit">@ReactMethod</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> nativeShowImagePicker</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Callback</span><span class="pln"> callback</span><span class="pun">){</span></code></li><li class="L3"><code><span class="pln">        </span><span class="typ">Activity</span><span class="pln"> activity </span><span class="pun">=</span><span class="pln"> getCurrentActivity</span><span class="pun">();</span></code></li><li class="L4"><code><span class="pln">       </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">activity</span><span class="pun">==</span><span class="kwd">null</span><span class="pun">){</span></code></li><li class="L5"><code><span class="pln">           responseHelp</span><span class="pun">.</span><span class="pln">invokeError</span><span class="pun">(</span><span class="pln">callback</span><span class="pun">,</span><span class="str">"找不到MainActivity"</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">       </span><span class="pun">}</span></code></li><li class="L7"><code><span class="pln">        </span><span class="typ">AlertDialog</span><span class="pln"> alertDialog </span><span class="pun">=</span><span class="pln"> </span><span class="typ">UiAlert</span><span class="pun">.</span><span class="pln">shooseAlert</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UiAlert</span><span class="pun">.</span><span class="typ">UIAlertListener</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L9"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onReturnResult</span><span class="pun">(</span><span class="typ">MyNativeModule</span><span class="pln"> myNativeModule</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">                </span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">makeText</span><span class="pun">(</span><span class="pln">myNativeModule</span><span class="pun">.</span><span class="pln">getActivity</span><span class="pun">(),</span><span class="str">"ssssssss"</span><span class="pun">,</span><span class="typ">Toast</span><span class="pun">.</span><span class="pln">LENGTH_SHORT</span><span class="pun">).</span><span class="pln">show</span><span class="pun">();</span></code></li><li class="L1"><code><span class="pln">                callback</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="str">"你选择了某条"</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L4"><code><span class="pln">        alertDialog</span><span class="pun">.</span><span class="pln">show</span><span class="pun">();</span></code></li><li class="L5"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pun">}</span></code></li></ol></pre></div>
</body>
</html>